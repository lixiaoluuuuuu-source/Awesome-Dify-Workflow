app:
  description: é£è¡Œæœºç¥¨ä»·æ ¼ç›‘æ§å·¥ä½œæµ
  icon: ğŸ’°
  icon_background: '#52C41A'
  mode: workflow
  name: æœºç¥¨ä»·æ ¼ç›‘æ§å·¥ä½œæµ
  use_icon_as_answer_icon: false

version: 0.1.0

workflow:
  nodes:
    - data:
        desc: æ¥æ”¶ä»·æ ¼ç›‘æ§å‚æ•°
        title: è¾“å…¥æŸ¥è¯¢å‚æ•°
        variables:
          - departure:
              type: string
              required: true
              description: å‡ºå‘åŸå¸‚
          - destination:
              type: string
              required: true
              description: ç›®çš„åŸå¸‚
          - travel_date:
              type: string
              required: true
              description: å‡ºè¡Œæ—¥æœŸ (YYYY-MM-DD)
          - price_threshold:
              type: number
              required: false
              description: ä»·æ ¼ä¸‹è·Œé˜ˆå€¼ï¼ˆå¯é€‰ï¼‰
      position:
        x: 100
        y: 100
      size:
        height: 100
        width: 200
      type: start
      id: start_price_monitor

    - data:
        desc: è°ƒç”¨ä»·æ ¼æŸ¥è¯¢API
        title: æŸ¥è¯¢æœºç¥¨ä»·æ ¼
        code: |
          from main import monitor_flight_price
          
          try:
              result = monitor_flight_price(
                  departure=departure,
                  destination=destination,
                  date=travel_date
              )
              
              return {
                  "success": True,
                  "departure": result["departure"],
                  "destination": result["destination"],
                  "date": result["date"],
                  "price": result["price"],
                  "trend": result["trend"],
                  "tips": result["tips"],
                  "timestamp": result["timestamp"]
              }
          except Exception as e:
              return {
                  "success": False,
                  "error": str(e),
                  "message": "ä»·æ ¼æŸ¥è¯¢å¤±è´¥"
              }
      position:
        x: 400
        y: 100
      size:
        height: 100
        width: 200
      type: code
      id: query_price

    - data:
        desc: åˆ†æä»·æ ¼å˜åŒ–è¶‹åŠ¿
        title: è¶‹åŠ¿åˆ†æ
        code: |
          import json
          
          # åˆ†æä»·æ ¼è¶‹åŠ¿
          if result["success"]:
              price = result["price"]
              trend = result["trend"]
              
              # åˆ¤æ–­æ˜¯å¦éœ€è¦å‘Šè­¦
              alert_level = "normal"
              if "ä¸‹è·Œ" in trend:
                  alert_level = "high"
              elif "ä¸Šæ¶¨" in trend:
                  alert_level = "warning"
              else:
                  alert_level = "normal"
              
              return {
                  "price": price,
                  "trend": trend,
                  "alert_level": alert_level,
                  "recommendation": "ç°åœ¨ä¸‹å•" if alert_level == "high" else "ç»§ç»­è§‚å¯Ÿ" if alert_level == "warning" else "æŒå¹³ï¼Œç­‰å¾…"
              }
          else:
              return {
                  "price": None,
                  "trend": None,
                  "alert_level": "error",
                  "recommendation": "æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•"
              }
      position:
        x: 700
        y: 100
      size:
        height: 100
        width: 200
      type: code
      id: analyze_trend

    - data:
        desc: æ‰¹é‡æŸ¥è¯¢å¤šæ¡è·¯çº¿
        title: æ‰¹é‡æŸ¥è¯¢
        code: |
          from main import monitor_flight_price
          
          routes = [
              (departure, destination, travel_date)
          ]
          
          results = []
          for dep, dest, date in routes:
              try:
                  result = monitor_flight_price(dep, dest, date)
                  results.append({
                      "route": f"{dep} â†’ {dest}",
                      "date": date,
                      "price": result["price"],
                      "trend": result["trend"]
                  })
              except Exception as e:
                  results.append({
                      "route": f"{dep} â†’ {dest}",
                      "date": date,
                      "error": str(e)
                  })
          
          return {
              "total_routes": len(results),
              "results": results
          }
      position:
        x: 400
        y: 300
      size:
        height: 100
        width: 200
      type: code
      id: batch_query

    - data:
        desc: ç”Ÿæˆä»·æ ¼ç›‘æ§æŠ¥å‘Š
        title: ç”ŸæˆæŠ¥å‘Š
        code: |
          report = {
              "query_time": result.get("timestamp", ""),
              "route": f"{result.get('departure', '')} â†’ {result.get('destination', '')}",
              "travel_date": result.get("date", ""),
              "current_price": result.get("price", 0),
              "price_trend": result.get("trend", "æœªçŸ¥"),
              "recommendation": analysis.get("recommendation", ""),
              "alert_level": analysis.get("alert_level", ""),
              "summary": result.get("tips", "")
          }
          
          return report
      position:
        x: 1000
        y: 100
      size:
        height: 100
        width: 200
      type: code
      id: generate_report

    - data:
        desc: è¾“å‡ºä»·æ ¼ç›‘æ§ç»“æœ
        title: ç»“æœè¾“å‡º
        output_type: object
      position:
        x: 1300
        y: 100
      size:
        height: 100
        width: 200
      type: end
      id: end_monitor

  edges:
    - source: start_price_monitor
      target: query_price
    - source: start_price_monitor
      target: batch_query
    - source: query_price
      target: analyze_trend
    - source: analyze_trend
      target: generate_report
    - source: generate_report
      target: end_monitor
    - source: batch_query
      target: end_monitor

  variable_declaration:
    - departure:
        type: string
        description: å‡ºå‘åŸå¸‚
    - destination:
        type: string
        description: ç›®çš„åŸå¸‚
    - travel_date:
        type: string
        description: å‡ºè¡Œæ—¥æœŸ
    - price_threshold:
        type: number
        description: ä»·æ ¼ä¸‹è·Œé˜ˆå€¼

plugins:
  - python:
      enabled: true
      version: '3.8+'
  - http:
      enabled: true

features:
  - single_query: å•æ¬¡ä»·æ ¼æŸ¥è¯¢
  - batch_query: æ‰¹é‡æŸ¥è¯¢
  - price_drop_detection: ä»·æ ¼ä¸‹è·Œæ£€æµ‹
  - report_generation: æŠ¥å‘Šç”Ÿæˆ
  - trend_analysis: è¶‹åŠ¿åˆ†æ

author: Awesome-Dify-Workflow
description: é£è¡Œæœºç¥¨ä»·æ ¼ç›‘æ§å·¥ä½œæµï¼Œæ”¯æŒå•æ¬¡/æ‰¹é‡æŸ¥è¯¢å’Œè¶‹åŠ¿åˆ†æ
